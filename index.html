<!DOCTYPE html>
<html>
<head>
  <title>Ambulance Dashboard</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>

<h2>ðŸš‘ Ambulance Panel</h2>

<p id="location">Location: --</p>
<p id="hospitalStatus">Hospital Info: --</p>

<button onclick="selectHospital()">Select Hospital H1</button>

<script>

const { createClient } = supabase;

const supabaseClient = createClient(
  "https://inlkqessbewmxmtfvzfe.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlubGtxZXNzYmV3bXhtdGZ2emZlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkwNjgxODYsImV4cCI6MjA4NDY0NDE4Nn0.5qiSgu3WlXJW4ARwwLC5XV6zvMwfGdH_xtUlu_qat0I"
);

let ambulanceId = "A1";

setInterval(async () => {

  let lat = 17.38 + Math.random()/100;
  let lng = 78.48 + Math.random()/100;

  document.getElementById("location").innerText =
    "Location: " + lat.toFixed(5) + ", " + lng.toFixed(5);

  await supabaseClient.from("ambulances").update({
    latitude: lat,
    longitude: lng,
    status: "Moving"
  }).eq("id", ambulanceId);

}, 5000);


async function selectHospital() {

  await supabaseClient.from("ambulances").update({
    selected_hospital: "H1",
    status: "On The Way"
  }).eq("id", ambulanceId);

}

supabaseClient
  .channel("hospital-updates")
  .on(
    "postgres_changes",
    { event: "UPDATE", schema: "public", table: "hospitals" },
    payload => {

      if(payload.new.id === "H1") {
        document.getElementById("hospitalStatus").innerText =
          "Beds: " + payload.new.beds_available +
          " | Doctor: " + payload.new.doctor_available;
      }

    }
  )
  .subscribe();

</script>

</body>
</html>

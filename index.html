<!DOCTYPE html>
<html>
<head>
  <title>ðŸš‘ Ambulance Panel</title>
</head>
<body>

<h2>ðŸš‘ Ambulance Live Tracking</h2>
<p id="status">Waiting for GPS...</p>
<button id="alertBtn">ðŸš¨ Send Emergency Alert</button>

<script type="module">

import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm"

const supabase = createClient(
  "https://cfmxqwaopfahthflqgih.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNmbXhxd2FvcGZhaHRoZmxxZ2loIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIwNjg4NjEsImV4cCI6MjA4NzY0NDg2MX0.38jNHf-7UGhIelL87oWxB5eK0e5ZivfGSsyEv1C9pL0"
);

/* Ensure row exists */
await supabase
  .from("ambulance_location")
  .upsert(
    { ambulance_id: 1, lat: 17.3850, lng: 78.4867 },
    { onConflict: "ambulance_id" }
  );

/* Live GPS Tracking */
navigator.geolocation.watchPosition(
  async (position) => {

    const lat = position.coords.latitude;
    const lng = position.coords.longitude;

    document.getElementById("status").innerText =
      "Live Location: " + lat + ", " + lng;

    await supabase
      .from("ambulance_location")
      .upsert(
        { ambulance_id: 1, lat: lat, lng: lng },
        { onConflict: "ambulance_id" }
      );

  },
  (error) => {
    console.log("GPS Error:", error);
  },
  { enableHighAccuracy: true }
);

/* Send Alert */
document.getElementById("alertBtn").addEventListener("click", async () => {

  const { data } = await supabase
    .from("ambulance_location")
    .select("*")
    .eq("ambulance_id", 1)
    .single();

  await supabase
    .from("emergency_alerts")
    .insert([{
      ambulance_id: 1,
      latitude: data.lat,
      longitude: data.lng
    }]);

  alert("ðŸš¨ Alert Sent to Police & Hospital");

});

</script>

</body>
</html>

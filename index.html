<!DOCTYPE html>
<html>
<head>
  <title>üöë Ambulance Panel</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #ff4d4d, #b30000);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .container {
      background: white;
      width: 420px;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 15px 40px rgba(0,0,0,0.3);
      text-align: center;
    }
    .status-box {
      background: #f5f5f5;
      padding: 12px;
      border-radius: 10px;
      margin: 15px 0;
    }
    button {
      width: 100%;
      padding: 12px;
      background: red;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
    select {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 8px;
    }
  </style>
</head>
<body>

<div class="container">
  <h2>üöë Smart Ambulance</h2>
  <div class="status-box" id="status">Waiting for GPS...</div>

  <button id="alertBtn">üö® SEND EMERGENCY ALERT</button>

  <h4>üè• Select Destination Hospital</h4>
  <select id="hospitalDropdown">
    <option>Loading hospitals...</option>
  </select>
</div>

<script type="module">

import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
  "https://cfmxqwaopfahthflqgih.supabase.co",
  "YOUR_ANON_KEY"
);

let currentLat = 0;
let currentLng = 0;

/* Live GPS */
navigator.geolocation.watchPosition(async (pos) => {

  currentLat = pos.coords.latitude;
  currentLng = pos.coords.longitude;

  document.getElementById("status").innerText =
    `üìç ${currentLat.toFixed(5)}, ${currentLng.toFixed(5)}`;

  await supabase
    .from("ambulance_location")
    .upsert(
      { ambulance_id: 1, lat: currentLat, lng: currentLng },
      { onConflict: "ambulance_id" }
    );

});

/* Load Hospitals */
async function loadHospitals() {

  const { data } = await supabase.from("hospitals").select("*");

  const dropdown = document.getElementById("hospitalDropdown");
  dropdown.innerHTML = "";

  data.forEach(h => {
    const option = document.createElement("option");
    option.value = h.id;
    option.text = h.name;
    dropdown.appendChild(option);
  });
}

await loadHospitals();

/* Select Hospital */
document.getElementById("hospitalDropdown")
.addEventListener("change", async function() {

  const hospitalId = this.value;

  await supabase
    .from("emergency_alerts")
    .insert([{
      ambulance_id: 1,
      latitude: currentLat,
      longitude: currentLng,
      hospital_id: hospitalId,
      status: "ACTIVE"
    }]);

  alert("üè• Destination Selected");

});

</script>
</body>
</html>

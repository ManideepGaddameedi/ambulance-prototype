<!DOCTYPE html>
<html>
<head>
  <title>Police Dashboard â€“ Smart Ambulance</title>

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />

  <style>
    #map {
      height: 100vh;
      width: 100%;
    }
  </style>
</head>
<body>

<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Supabase JS -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

<script>
  // ðŸ”¹ Supabase config
  const supabaseUrl = "https://YOUR_PROJECT_ID.supabase.co";
  const supabaseKey = "YOUR_ANON_PUBLIC_KEY";
  const supabase = supabase.createClient(supabaseUrl, supabaseKey);

  // ðŸ”¹ Hospital (fixed)
  const hospitalLat = 17.3850;
  const hospitalLng = 78.4867;

  // ðŸ”¹ Map init
  const map = L.map("map").setView([hospitalLat, hospitalLng], 14);

  // Base Map (roads, buildings, landmarks)
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    attribution: "Â© OpenStreetMap"
  }).addTo(map);

  // ðŸ”¹ Icons
  const ambulanceIcon = L.icon({
    iconUrl: "https://cdn-icons-png.flaticon.com/512/2967/2967350.png",
    iconSize: [40, 40]
  });

  const hospitalIcon = L.icon({
    iconUrl: "https://cdn-icons-png.flaticon.com/512/3448/3448513.png",
    iconSize: [40, 40]
  });

  // ðŸ”¹ Hospital Marker
  const hospitalMarker = L.marker(
    [hospitalLat, hospitalLng],
    { icon: hospitalIcon }
  ).addTo(map).bindPopup("Hospital");

  // ðŸ”¹ Ambulance Marker (initial)
  let ambulanceMarker = L.marker(
    [hospitalLat, hospitalLng],
    { icon: ambulanceIcon }
  ).addTo(map).bindPopup("Ambulance");

  // ðŸ”¹ Route line
  let routeLine = L.polyline([], {
    color: "red",
    weight: 4
  }).addTo(map);

  // ðŸ”¹ Listen for live GPS updates
  supabase
    .channel("ambulance-live")
    .on(
      "postgres_changes",
      {
        event: "UPDATE",
        schema: "public",
        table: "ambulance_location"
      },
      (payload) => {
        const lat = payload.new.latitude;
        const lng = payload.new.longitude;

        ambulanceMarker.setLatLng([lat, lng]);

        routeLine.setLatLngs([
          [lat, lng],
          [hospitalLat, hospitalLng]
        ]);

        map.panTo([lat, lng]);
      }
    )
    .subscribe();
</script>

</body>
</html>

<!DOCTYPE html>
<html>
<head>
  <title>Traffic Police Control</title>
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
</head>
<body>

<h2>ðŸš¦ Traffic Police Control</h2>

<div id="map" style="height:400px;"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
const supabaseClient = supabase.createClient(
  "https://inlkqessbewmxmtfvzfe.supabase.co",
  "PASTE_YOUR_ANON_KEY_HERE"
);

const map = L.map("map").setView([17, 78], 6);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png")
  .addTo(map);

let marker = null;

async function fetchLocation() {
  const { data } = await supabaseClient
    .from("alerts")
    .select("*")
    .eq("id", 1)
    .single();

  if (!data || !data.location) return;

  const parts = data.location.split(",");
  const lat = parseFloat(parts[0]);
  const lng = parseFloat(parts[1]);

  if (!marker) {
    marker = L.marker([lat, lng]).addTo(map);
    map.setView([lat, lng], 15);
  } else {
    marker.setLatLng([lat, lng]);
  }
}

setInterval(fetchLocation, 2000);
</script>

</body>
</html>

<!DOCTYPE html>
<html>
<body>

<h3 id="name">Waitingâ€¦</h3>
<div id="map" style="height:300px"></div>

<link rel="stylesheet"
 href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
const supabaseClient = supabase.createClient(
  "https://inlkqessbewmxmtfvzfe.supabase.co",
  "YOUR_ANON_KEY"
);

let map = L.map("map").setView([17,78],10);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png")
.addTo(map);

let marker;

async function fetchData() {
  const { data } = await supabaseClient
    .from("alerts").select("*").eq("id",1).single();

  if (!data) return;

  document.getElementById("name").innerText =
    data.location_name;

  if (data.latitude && data.longitude) {
    const pos = [data.latitude, data.longitude];
    if (!marker) {
      marker = L.marker(pos).addTo(map);
      map.setView(pos, 15);
    } else {
      marker.setLatLng(pos);
    }
  }
}

setInterval(fetchData, 2000);
</script>

</body>
</html>

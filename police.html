
<!DOCTYPE html>
<html>
<head>
  <title>Police Dashboard</title>
  <meta charset="utf-8">

  <link rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <style>
    #map { height: 100vh; }
  </style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

<script>
const supabase = supabase.createClient(
  "https://inlkqessbewmxmtfvzfe.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmV3bXhtdGZ2emZlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkwNjgxODYsImV4cCI6MjA4NDY0NDE4Nn0.5qiSgu3WlXJW4ARwwLC5XV6zvMwfGdH_xtUlu_qat0l"
);

// ðŸ¥ Hospital
const hospital = [17.3850, 78.4867];

const map = L.map("map").setView(hospital, 14);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png")
  .addTo(map);

const ambulanceIcon = L.icon({
  iconUrl: "https://cdn-icons-png.flaticon.com/512/2967/2967350.png",
  iconSize: [40, 40]
});

const hospitalIcon = L.icon({
  iconUrl: "https://cdn-icons-png.flaticon.com/512/3448/3448513.png",
  iconSize: [40, 40]
});

L.marker(hospital, { icon: hospitalIcon })
  .addTo(map).bindPopup("Hospital");

let ambulanceMarker = L.marker(hospital, { icon: ambulanceIcon })
  .addTo(map);

let route = L.polyline([], { color: "red" }).addTo(map);

// ðŸ”¥ REALTIME LISTENER
supabase.channel("live")
.on("postgres_changes", {
  event: "*",
  schema: "public",
  table: "ambulance_location"
}, payload => {

  const lat = payload.new.latitude;
  const lng = payload.new.longitude;

  ambulanceMarker.setLatLng([lat, lng]);
  route.setLatLngs([[lat, lng], hospital]);
  map.panTo([lat, lng]);

}).subscribe();
</script>

</body>
</html>

<!DOCTYPE html>
<html>
<head>
  <title>Police Dashboard â€“ Smart Ambulance</title>
  <meta charset="utf-8" />

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />

  <style>
    #map {
      height: 100vh;
      width: 100%;
    }
  </style>
</head>
<body>

<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Supabase JS -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

<script>
  // âœ… YOUR SUPABASE DETAILS
  const supabaseUrl = "https://inlkqessbewmxmtfvzfe.supabase.co";
  const supabaseKey =
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmV3bXhtdGZ2emZlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkwNjgxODYsImV4cCI6MjA4NDY0NDE4Nn0.5qiSgu3WlXJW4ARwwLC5XV6zvMwfGdH_xtUlu_qat0l";

  const supabase = supabase.createClient(supabaseUrl, supabaseKey);

  // ðŸ¥ Hospital (fixed location â€“ change if needed)
  const hospitalLat = 17.3850;
  const hospitalLng = 78.4867;

  // ðŸ—ºï¸ Map initialization
  const map = L.map("map").setView([hospitalLat, hospitalLng], 14);

  // Base map: roads, buildings, landmarks
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    attribution: "Â© OpenStreetMap"
  }).addTo(map);

  // ðŸš‘ Ambulance icon
  const ambulanceIcon = L.icon({
    iconUrl: "https://cdn-icons-png.flaticon.com/512/2967/2967350.png",
    iconSize: [40, 40]
  });

  // ðŸ¥ Hospital icon
  const hospitalIcon = L.icon({
    iconUrl: "https://cdn-icons-png.flaticon.com/512/3448/3448513.png",
    iconSize: [40, 40]
  });

  // Hospital marker (fixed)
  L.marker([hospitalLat, hospitalLng], { icon: hospitalIcon })
    .addTo(map)
    .bindPopup("Hospital");

  // Ambulance marker (live)
  let ambulanceMarker = L.marker(
    [hospitalLat, hospitalLng],
    { icon: ambulanceIcon }
  ).addTo(map).bindPopup("Ambulance");

  // Route line (polyline)
  let routeLine = L.polyline([], {
    color: "red",
    weight: 4
  }).addTo(map);

  // ðŸ”´ Real-time GPS updates from Supabase
  supabase
    .channel("ambulance-live")
    .on(
      "postgres_changes",
      {
        event: "UPDATE",
        schema: "public",
        table: "ambulance_location"
      },
      (payload) => {
        const lat = payload.new.latitude;
        const lng = payload.new.longitude;

        // Move ambulance
        ambulanceMarker.setLatLng([lat, lng]);

        // Draw route line
        routeLine.setLatLngs([
          [lat, lng],
          [hospitalLat, hospitalLng]
        ]);

        // Center map
        map.panTo([lat, lng]);
      }
    )
    .subscribe();
</script>

</body>
</html>

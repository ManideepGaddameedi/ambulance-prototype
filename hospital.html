<!DOCTYPE html>
<html>
<head>
  <title>Hospital Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>

<h2>üè• Hospital H1 Panel</h2>

<p id="ambulanceInfo">Waiting for ambulance...</p>

<label>Beds Available:</label>
<input type="number" id="beds" value="5"><br><br>

<label>Doctor Available:</label>
<select id="doctor">
  <option value="true">Yes</option>
  <option value="false">No</option>
</select><br><br>

<button onclick="updateHospital()">Update</button>

<script>

const supabase = supabase.createClient(
  "https://inlkqessbewmxmtfvzfe.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlubGtxZXNzYmV3bXhtdGZ2emZlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkwNjgxODYsImV4cCI6MjA4NDY0NDE4Nn0.5qiSgu3WlXJW4ARwwLC5XV6zvMwfGdH_xtUlu_qat0I"
);

let hospitalId = "H1";

// Listen ambulance updates
supabase
  .channel("ambulance-updates")
  .on(
    "postgres_changes",
    { event: "UPDATE", schema: "public", table: "ambulances" },
    payload => {

      if(payload.new.selected_hospital === hospitalId) {

        document.getElementById("ambulanceInfo").innerText =
          "Ambulance Incoming üöë\n" +
          "Location: " + payload.new.latitude +
          ", " + payload.new.longitude +
          "\nStatus: " + payload.new.status;

      }

    }
  )
  .subscribe();


// Update hospital status
function updateHospital() {

  let beds = parseInt(document.getElementById("beds").value);
  let doctor = document.getElementById("doctor").value === "true";

  supabase.from("hospitals").update({
    beds_available: beds,
    doctor_available: doctor
  }).eq("id", hospitalId);

  alert("Hospital Updated!");
}

</script>

</body>
</html>
